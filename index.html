<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Golden Moms ‚Äî Panel</title>
<link rel="icon" href="Logo.webp"/>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<style>
:root{
  --blue:#0f3a78;--lime:#9be22d;--ink:#0f172a;--mut:#64748b;
  --b:#e2e8f0;--bg:#f7f8fa;--ok:#d9f99d;--mid:#fef9c3;--no:#fee2e2;
  --card:#ffffff; --shadow:0 8px 20px #0000000a;
}
*{box-sizing:border-box}
html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
a{color:inherit}
button{font:inherit}
.badge{font-size:11px;border:1px solid var(--b);border-radius:999px;padding:2px 8px;background:#f8fafc;white-space:nowrap}
.btn{border:1px solid var(--b);border-radius:10px;padding:8px 12px;background:#fff;cursor:pointer}
.btn.p{background:var(--lime);border-color:#a3e635;font-weight:800}
.btn.s{background:#f8fafc}
.top{position:sticky;top:0;z-index:20;background:#fff;border-bottom:1px solid var(--b);display:flex;align-items:center;justify-content:space-between;padding:10px 14px}
.brand{display:flex;gap:10px;align-items:center}
.brand img{width:32px;height:32px;border-radius:50%;border:2px solid var(--blue)}
.nav{display:flex;gap:8px;flex-wrap:wrap}
.nav .tab{border:1px solid var(--b);border-radius:999px;padding:8px 12px;background:#fff;cursor:pointer}
.nav .tab.active{background:var(--blue);color:#fff}
.container{max-width:1200px;margin:14px auto;padding:0 12px}
.grid{display:grid;grid-template-columns:repeat(12,1fr);gap:12px}
.card{background:var(--card);border:1px solid var(--b);border-radius:12px;box-shadow:var(--shadow);padding:12px}
.kpi h3{margin:0;color:var(--mut);font-size:14px}.kpi .n{font-size:22px;font-weight:800}

/* ===== Eventos (Agenda mensual) ===== */
.ev-head{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin-bottom:10px}
.ev-title{font-weight:800;font-size:22px;margin-right:auto}
.ev-month-nav{display:flex;gap:6px}
.ev-day{background:#fff;border:1px solid var(--b);border-radius:14px;padding:10px 12px;margin-bottom:10px}
.ev-day-top{display:flex;align-items:center;gap:10px;margin-bottom:6px}
.ev-day-num{font-weight:900;font-size:18px;min-width:28px}
.ev-day-week{color:var(--mut);font-size:12px;text-transform:lowercase}
.ev-day-add{margin-left:auto;border:1px dashed var(--b);padding:4px 8px;border-radius:999px;background:#fff}
.ev-item{border:1px solid var(--b);border-radius:12px;padding:8px 10px;margin-top:8px;background:#fcfdfd}
.ev-row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.ev-time{font-weight:700;color:#0f3a78;font-size:13px}
.tag{font-size:10px;border:1px solid #0001;border-radius:999px;padding:2px 6px;display:inline-block}
.tag.match{background:#e0edff;border-color:#b7d1ff;color:#0f3a78}
.tag.train{background:#e9fbd0;border-color:#c6f28a;color:#2d5a00}

.ev-info{font-size:13px;color:#0f172a}
.ev-meta{font-size:12px;color:#64748b}
.ev-actions{margin-left:auto;display:flex;gap:6px}
.ev-actions .btn{padding:4px 8px}

/* Cuadr√≠cula mes (desktop) */
.cal-head{display:grid;grid-template-columns:repeat(7,1fr);gap:8px;position:sticky;top:114px;z-index:5;background:#fff;padding:6px 0;border-bottom:1px solid var(--b)}
.cal-head>div{text-align:center;font-weight:700;color:#0f3a78}
.cal-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:8px}
.cal-cell{min-height:140px;background:#fff;border:1px solid var(--b);border-radius:12px;padding:8px;overflow:hidden}
.cal-date{font-size:12px;color:#64748b;font-weight:700;display:flex;justify-content:space-between;align-items:center}
.cal-plus{border:1px dashed var(--b);border-radius:6px;padding:0 6px;font-size:12px;cursor:pointer;background:#fff}

/* Modal */
.modal{position:fixed;inset:0;background:#0006;display:none;align-items:center;justify-content:center;padding:16px;z-index:40}
.modal.show{display:flex}
.dialog{background:#fff;max-width:680px;width:100%;border-radius:16px;border:1px solid var(--b);box-shadow:var(--shadow);padding:16px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
label{font-size:12px;color:#64748b}
input[type="text"],input[type="datetime-local"],select{width:100%;padding:10px;border:1px solid var(--b);border-radius:10px;background:#fff}
.dialog-actions{display:flex;justify-content:flex-end;gap:10px;margin-top:12px}
.small{font-size:12px;color:#64748b}

@media (max-width: 900px){
  .grid{grid-template-columns:1fr}
  .cal-head{top:154px}
  .form-row{grid-template-columns:1fr}
  .ev-title{font-size:20px}
}
</style>
</head>
<body>

<!-- Top -->
<div class="top">
  <div class="brand">
    <img src="Logo.webp" alt="GM"/>
    <div><strong>Golden</strong> <span style="color:var(--lime);font-weight:800">Moms</span></div>
  </div>
  <div class="nav">
    <button class="tab" data-view="dash">Dashboard</button>
    <button class="tab active" data-view="events">Eventos</button>
    <button class="tab" data-view="roster">Plantel</button>
    <button class="tab" data-view="track">Seguimiento</button>
  </div>
</div>

<div class="container">
  <!-- DASHBOARD -->
  <section id="v-dash" style="display:none">
    <div class="grid">
      <div class="card kpi" style="grid-column:span 3"><h3>Pr√≥ximos eventos</h3><div class="n" id="kEvents">0</div></div>
      <div class="card kpi" style="grid-column:span 3"><h3>Plantel</h3><div class="n" id="kRoster">0</div></div>
      <div class="card kpi" style="grid-column:span 3"><h3>Convocadas (pr√≥x.)</h3><div class="n" id="kOk">0</div></div>
      <div class="card kpi" style="grid-column:span 3"><h3>Partidos jugados</h3><div class="n" id="kGames">0</div></div>
    </div>
    <div class="card" style="margin-top:12px">
      <strong>üéÇ Pr√≥ximos cumplea√±os</strong>
      <ul id="upBirth" style="margin:8px 0 0 16px"></ul>
    </div>
    <div class="card" style="margin-top:12px">
      <strong>üìÖ Eventos de la semana</strong>
      <ul id="weekEvents" style="margin:8px 0 0 16px"></ul>
    </div>
  </section>

  <!-- EVENTOS -->
  <section id="v-events">
    <div class="card">
      <div class="ev-head">
        <div class="ev-title" id="monthTitle">Mes</div>
        <div class="ev-month-nav">
          <button class="btn s" id="btnToday">Hoy</button>
          <button class="btn s" id="btnPrev">‚óÄ</button>
          <button class="btn s" id="btnNext">‚ñ∂</button>
          <button class="btn p" id="btnNewEvent">Nuevo Evento</button>
        </div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <span class="badge" id="toggleAgenda" style="cursor:pointer;background:#eaffcf">Agenda</span>
          <span class="badge" id="toggleGrid" style="cursor:pointer">Cuadr√≠cula</span>
        </div>
      </div>

      <!-- Agenda (m√≥vil / default) -->
      <div id="agendaWrap"></div>

      <!-- Cuadr√≠cula (desktop) -->
      <div id="gridWrap" style="display:none">
        <div class="cal-head"><div>Lun</div><div>Mar</div><div>Mi√©</div><div>Jue</div><div>Vie</div><div>S√°b</div><div>Dom</div></div>
        <div id="calGrid" class="cal-grid"></div>
      </div>
    </div>
  </section>

  <!-- PLANTEL -->
  <section id="v-roster" style="display:none">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>Plantel</strong>
        <button id="btnAddPlayer" class="btn s">Agregar jugadora</button>
      </div>
      <div id="rosterGrid" class="grid"></div>
    </div>
  </section>

  <!-- SEGUIMIENTO -->
  <section id="v-track" style="display:none">
    <div class="card">
      <strong>Seguimiento de partidos</strong>
      <div id="trackList"></div>
    </div>
  </section>
</div>

<footer style="text-align:center;color:var(--mut);font-size:14px;margin:26px 0">Golden Moms ¬∑ hecho con üíö lima & azul</footer>

<!-- Modal Crear/Editar -->
<div class="modal" id="evModal">
  <div class="dialog">
    <h3 id="evModalTitle" style="margin:0 0 8px 0">Nuevo evento</h3>
    <div class="form-row">
      <div><label>T√≠tulo</label><input id="f_title" type="text" placeholder="Ej: Liga vs Rivales"></div>
      <div>
        <label>Tipo</label>
        <select id="f_type">
          <option value="Entrenamiento">Entrenamiento</option>
          <option value="Partido">Partido</option>
        </select>
      </div>
    </div>
    <div class="form-row">
      <div>
        <label>Fecha y hora</label>
        <input id="f_datetime" type="datetime-local">
      </div>
      <div>
        <label>Equipo</label>
        <input id="f_team" type="text" value="Golden Moms">
      </div>
    </div>
    <div class="form-row">
      <div>
        <label>Rival</label>
        <input id="f_opponent" type="text" placeholder="Rival / Competencia">
      </div>
      <div>
        <label>Uniforme</label>
        <select id="f_uniform">
          <option value="">(sin especificar)</option>
          <option value="Polera azul">Polera azul</option>
          <option value="Polera verde lima">Polera verde lima</option>
        </select>
        <div class="small">* siempre medias verde lima</div>
      </div>
    </div>
    <div class="form-row">
      <div>
        <label>Ubicaci√≥n</label>
        <input id="f_location" type="text" placeholder="Colegio / Cancha / Direcci√≥n">
      </div>
      <div>
        <label>Notas (opcional)</label>
        <input id="f_notes" type="text" placeholder="Info extra">
      </div>
    </div>
    <div class="dialog-actions">
      <button class="btn s" id="btnDelete" style="display:none;color:#b91c1c;border-color:#fecaca;background:#fee2e2">Eliminar</button>
      <div style="flex:1"></div>
      <button class="btn s" id="btnCancel">Cancelar</button>
      <button class="btn p" id="btnSave">Guardar</button>
    </div>
  </div>
</div>

<script>
/* ========= SUPABASE ========= */
const SUPA = {
  url: "https://xglojvvbgaivwbpdxvne.supabase.co",
  key: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhnbG9qdnZiZ2FpdndicGR4dm5lIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUxMjEzMjQsImV4cCI6MjA3MDY5NzMyNH0.vQOBuvphgm0iue-lybJoBVhyai7RtRp8Tfn-hGIKKgw"
};
const supa = supabase.createClient(SUPA.url, SUPA.key);

/* ========= Navegaci√≥n ========= */
document.querySelectorAll('.nav .tab').forEach(btn=>{
  btn.onclick=()=>{
    document.querySelectorAll('.nav .tab').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    showView(btn.dataset.view);
  };
});
function showView(v){
  ['dash','events','roster','track'].forEach(id=>document.getElementById('v-'+id).style.display='none');
  document.getElementById('v-'+v).style.display='block';
  if(v==='dash') renderDash();
  if(v==='events') renderEvents();
  if(v==='roster') renderRoster();
  if(v==='track') renderTrack();
}

/* ========= Utilidades de fecha ========= */
const fmtDayName = d => d.toLocaleDateString('es-CL',{weekday:'short'});
const fmtMonthTitle = (y,m) => new Date(y,m,1).toLocaleDateString('es-CL',{month:'long',year:'numeric'});
const toLocalInput = (d) => {
  const z = new Date(d);
  const off = z.getTimezoneOffset();
  const local = new Date(z.getTime()-off*60000);
  return local.toISOString().slice(0,16);
};
const fromLocalInput = (str) => {
  // str es local (datetime-local). Lo convertimos a ISO real:
  const dt = new Date(str);
  return new Date(dt.getTime()-dt.getTimezoneOffset()*60000).toISOString();
};
const sameDay = (a,b) => a.getFullYear()==b.getFullYear() && a.getMonth()==b.getMonth() && a.getDate()==b.getDate();

/* ========= Estado Eventos ========= */
let cur = new Date(); // mes actual mostrado
let agendaMode = true; // agenda vs grid
let editingId = null;

/* ========= Agenda mensual ========= */
async function renderEvents(){
  document.getElementById('monthTitle').textContent =
    fmtMonthTitle(cur.getFullYear(), cur.getMonth()).replace(/^\w/, c => c.toUpperCase());

  document.getElementById('agendaWrap').innerHTML = '';
  document.getElementById('calGrid').innerHTML = '';

  // rango del mes (sin padding ‚Üí NO filas vac√≠as)
  const start = new Date(cur.getFullYear(), cur.getMonth(), 1, 0, 0, 0);
  const end   = new Date(cur.getFullYear(), cur.getMonth()+1, 0, 23, 59, 59);

  // Traemos todos los eventos del mes
  const { data:evs } = await supa.from("events")
    .select("*")
    .gte("datetime", start.toISOString())
    .lte("datetime", end.toISOString())
    .order("datetime", { ascending:true });

  // Agrupar por d√≠a
  const days = [];
  for(let d = 1; d <= end.getDate(); d++){
    days.push(new Date(cur.getFullYear(), cur.getMonth(), d));
  }

  // Render Agenda
  const wrap = document.getElementById('agendaWrap');
  days.forEach(day=>{
    const dayEvents = (evs||[]).filter(e=> sameDay(new Date(e.datetime), day));
    const dayEl = document.createElement('div');
    dayEl.className = 'ev-day';
    dayEl.innerHTML = `
      <div class="ev-day-top">
        <div class="ev-day-num">${day.getDate()}</div>
        <div class="ev-day-week">${day.toLocaleDateString('es-CL',{weekday:'short'})}</div>
        <button class="ev-day-add" data-date="${day.toISOString()}">+ Agregar</button>
      </div>
      <div class="ev-day-list"></div>
    `;
    const list = dayEl.querySelector('.ev-day-list');
    (dayEvents||[]).forEach(e=>{
      const d = new Date(e.datetime);
      const tagClass = e.type==='Partido' ? 'match' : 'train';
      const itm = document.createElement('div');
      itm.className='ev-item';
      itm.innerHTML = `
        <div class="ev-row">
          <span class="ev-time">${d.toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit'})}</span>
          <span class="tag ${tagClass}">${e.type}</span>
          <strong class="ev-info">${e.title || '(Sin t√≠tulo)'}</strong>
          <div class="ev-actions">
            <button class="btn s" data-edit="${e.id}">Editar</button>
          </div>
        </div>
        <div class="ev-meta">
          ${e.opponent ? `Rival: ${e.opponent} ¬∑ `:''}
          ${e.uniform ? `Uniforme: ${e.uniform} ¬∑ `:''}
          ${e.location ? `üìç ${e.location}`:''}
        </div>
      `;
      list.appendChild(itm);
    });
    wrap.appendChild(dayEl);
  });

  // Grid (solo desktop o si el usuario lo activa)
  if(!agendaMode){
    document.getElementById('gridWrap').style.display='block';
    document.getElementById('agendaWrap').style.display='none';

    // Para cuadr√≠cula s√≠ incluimos padding de la semana
    const grid = document.getElementById('calGrid');
    grid.innerHTML="";
    const first = new Date(cur.getFullYear(), cur.getMonth(), 1);
    const startIndex = (first.getDay()+6)%7; // convertir dom->6, lun->0
    for(let i=0;i<startIndex;i++){
      const c = document.createElement('div');
      c.className='cal-cell';
      grid.appendChild(c);
    }
    days.forEach(day=>{
      const dayEvents = (evs||[]).filter(e=> sameDay(new Date(e.datetime), day));
      const cell = document.createElement('div');
      cell.className='cal-cell';
      cell.innerHTML = `
        <div class="cal-date">
          <span>${day.getDate()}</span>
          <span class="cal-plus" data-date="${day.toISOString()}">+</span>
        </div>
        <div></div>`;
      const body = cell.lastElementChild;
      (dayEvents||[]).forEach(e=>{
        const d = new Date(e.datetime);
        const tagClass = e.type==='Partido' ? 'match':'train';
        const small = document.createElement('div');
        small.className='ev-item';
        small.innerHTML = `
          <div class="ev-row">
            <span class="ev-time">${d.toLocaleTimeString('es-CL',{hour:'2-digit',minute:'2-digit'})}</span>
            <span class="tag ${tagClass}">${e.type}</span>
            <span class="ev-info" style="font-weight:700">${e.title||'(Sin t√≠tulo)'}</span>
          </div>
          <div class="ev-meta">
            ${e.location?`üìç ${e.location}`:''}
          </div>
          <div style="margin-top:6px"><button class="btn s" data-edit="${e.id}">Editar</button></div>
        `;
        body.appendChild(small);
      });
      grid.appendChild(cell);
    });
  }else{
    document.getElementById('gridWrap').style.display='none';
    document.getElementById('agendaWrap').style.display='block';
  }

  // Handlers (+ por d√≠a) tanto en agenda como grid
  document.querySelectorAll('[data-date]').forEach(b=>{
    b.onclick=()=>openModalNew(new Date(b.getAttribute('data-date')));
  });
  // Editar
  document.querySelectorAll('[data-edit]').forEach(b=>{
    b.onclick=()=>openModalEdit(b.getAttribute('data-edit'));
  });
}

/* ========= Modal ========= */
const modal = document.getElementById('evModal');
const f_title = document.getElementById('f_title');
const f_type = document.getElementById('f_type');
const f_datetime = document.getElementById('f_datetime');
const f_team = document.getElementById('f_team');
const f_opponent = document.getElementById('f_opponent');
const f_uniform = document.getElementById('f_uniform');
const f_location = document.getElementById('f_location');
const f_notes = document.getElementById('f_notes');
const btnDelete = document.getElementById('btnDelete');

function openModalNew(prefillDate){
  editingId = null;
  document.getElementById('evModalTitle').textContent = 'Nuevo evento';
  f_title.value = ''; f_type.value='Entrenamiento';
  f_datetime.value = toLocalInput(prefillDate || new Date());
  f_team.value='Golden Moms'; f_opponent.value=''; f_uniform.value='';
  f_location.value=''; f_notes.value='';
  btnDelete.style.display='none';
  modal.classList.add('show');
}

async function openModalEdit(id){
  const { data, error } = await supa.from('events').select('*').eq('id', id).single();
  if(error || !data){ alert('No se pudo cargar el evento'); return; }
  editingId = id;
  document.getElementById('evModalTitle').textContent = 'Editar evento';
  f_title.value = data.title || '';
  f_type.value = data.type || 'Entrenamiento';
  f_datetime.value = toLocalInput(new Date(data.datetime));
  f_team.value = data.team || 'Golden Moms';
  f_opponent.value = data.opponent || '';
  f_uniform.value = data.uniform || '';
  f_location.value = data.location || '';
  f_notes.value = data.notes || '';
  btnDelete.style.display='inline-block';
  modal.classList.add('show');
}

document.getElementById('btnCancel').onclick = ()=> modal.classList.remove('show');
document.getElementById('btnSave').onclick = async ()=>{
  const payload = {
    title: f_title.value?.trim()||null,
    type: f_type.value,
    datetime: fromLocalInput(f_datetime.value),
    team: f_team.value?.trim()||'Golden Moms',
    opponent: f_opponent.value?.trim()||null,
    uniform: f_uniform.value||null,
    location: f_location.value?.trim()||null,
    notes: f_notes.value?.trim()||null
  };
  let res;
  if(editingId){
    res = await supa.from('events').update(payload).eq('id', editingId);
  }else{
    res = await supa.from('events').insert([payload]);
  }
  if(res.error){ alert('‚ùå '+res.error.message); return; }
  modal.classList.remove('show');
  renderEvents();
  renderDash(); // refresca KPIs
};
btnDelete.onclick = async ()=>{
  if(!editingId) return;
  if(!confirm('¬øEliminar este evento?')) return;
  const { error } = await supa.from('events').delete().eq('id', editingId);
  if(error){ alert('‚ùå '+error.message); return; }
  modal.classList.remove('show');
  renderEvents();
  renderDash();
};

/* ========= Botones de cabecera Eventos ========= */
document.getElementById('btnPrev').onclick = ()=>{ cur = new Date(cur.getFullYear(),cur.getMonth()-1,1); renderEvents(); };
document.getElementById('btnNext').onclick = ()=>{ cur = new Date(cur.getFullYear(),cur.getMonth()+1,1); renderEvents(); };
document.getElementById('btnToday').onclick= ()=>{ const now=new Date(); cur=new Date(now.getFullYear(),now.getMonth(),1); renderEvents(); };
document.getElementById('btnNewEvent').onclick= ()=> openModalNew(new Date());
document.getElementById('toggleAgenda').onclick= ()=>{ agendaMode=true; renderEvents(); };
document.getElementById('toggleGrid').onclick  = ()=>{ agendaMode=false; renderEvents(); };

/* ========= Plantel ========= */
async function renderRoster(){
  const {data}=await supa.from("players").select("*").order("nombre",{ascending:true});
  const grid=document.getElementById('rosterGrid'); grid.innerHTML="";
  (data||[]).forEach(p=>{
    const c=document.createElement("div"); c.className="card";
    c.innerHTML=`<strong>${p.nombre}</strong><br/>${p.apodo||""}<br/><span>${p.posicion||""}</span>`;
    grid.appendChild(c);
  });
}

/* ========= Seguimiento (placeholder simple) ========= */
async function renderTrack(){
  const {data}=await supa.from("results").select("*").order("created_at",{ascending:false}).limit(10);
  const wrap=document.getElementById("trackList"); wrap.innerHTML="";
  (data||[]).forEach(m=>{
    const div=document.createElement("div"); div.className="card";
    div.innerHTML=`<strong>Partido</strong><br/>
      ${m.notes||"-"}`;
    wrap.appendChild(div);
  });
}

/* ========= Dashboard ========= */
async function renderDash(){
  const now = new Date();
  const {data:events}=await supa.from("events").select("*").gte("datetime", now.toISOString());
  const {data:players}=await supa.from("players").select("*");

  document.getElementById('kEvents').textContent=events?.length||0;
  document.getElementById('kRoster').textContent=players?.length||0;
  document.getElementById('kOk').textContent=0;
  document.getElementById('kGames').textContent=0;

  // üéÇ Pr√≥ximos cumplea√±os (vista que ya tienes creada)
  try {
    const { data: birthdays, error: bErr } = await supa
      .from("vw_upcoming_birthdays")
      .select("*")
      .order("proximo_cumple", { ascending: true })
      .limit(5);
    const list = document.getElementById("upBirth");
    list.innerHTML = "";
    if (bErr) {
      list.innerHTML = "<li>Error al cargar cumplea√±os</li>";
    } else {
      (birthdays || []).forEach(p => {
        if (p.proximo_cumple) {
          const bd = new Date(p.proximo_cumple);
          list.innerHTML += `<li>${p.apodo || p.nombre} ‚Äî ${bd.toLocaleDateString("es-CL",{day:"2-digit",month:"short"})}</li>`;
        }
      });
    }
  } catch(e) {
    console.error("Fallo cumplea√±os:", e);
  }

  // üìÖ Eventos de la semana (usa tu vista server-side)
  try {
    const { data: weekEvents, error: eErr } = await supa
      .from("vw_events_this_week")
      .select("*")
      .order("datetime", { ascending: true });
    const week = document.getElementById('weekEvents'); 
    week.innerHTML="";
    if (eErr) {
      week.innerHTML = "<li>Error al cargar eventos</li>";
    } else {
      (weekEvents||[]).forEach(e=>{
        const d = new Date(e.datetime);
        week.innerHTML += `<li><strong>${e.title}</strong> ‚Äî ${d.toLocaleDateString("es-CL",{weekday:"short",day:"2-digit",month:"short",hour:"2-digit",minute:"2-digit"})}</li>`;
      });
    }
  } catch(e) {
    console.error("Fallo eventos:", e);
  }
}

/* ========= Inicial ========= */
showView('events'); // abrimos en Eventos (agenda) por tu flujo
renderDash();
</script>

</body>
</html>
